name: Claude Code Research Review

# 研究プロジェクト用 Claude Code レビューワークフロー
on:
  push:
    branches: [ main, master ]
    paths:
      - '**/*.py'
      - '**/*.ipynb'
      - '**/*.md'
      - '**/*.json'
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  claude-code-detection:
    name: Claude Code Detection
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
    
    - name: Detect Claude Code
      run: |
        echo "Scanning for Claude Code signatures..."
        if grep -r "Generated with.*Claude Code\|Co-Authored-By: Claude" . --exclude-dir=.git; then
          echo "✅ Claude Code detected"
        else
          echo "ℹ️ No Claude Code signatures found"
        fi
    
    - name: Count Files
      run: |
        echo "📊 Project Statistics:"
        echo "- Python files: $(find . -name "*.py" | wc -l)"
        echo "- Notebooks: $(find . -name "*.ipynb" | wc -l)" 
        echo "- Documentation: $(find . -name "*.md" | wc -l)"
        echo "- Total files: $(find . -type f | wc -l)"

  research-code-quality:
    name: Research Code Quality
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install black isort flake8
    
    - name: Check Code Format
      run: |
        echo "Checking Python code formatting..."
        black --check --diff . || echo "Some files need formatting"
    
    - name: Check Import Sorting
      run: |
        echo "Checking import sorting..."
        isort --check-only --diff . || echo "Some imports need sorting"
    
    - name: Lint Code
      run: |
        echo "Linting code..."
        flake8 . --count --max-line-length=127 --statistics || true

  research-summary:
    name: Research Summary
    runs-on: ubuntu-latest
    needs: [claude-code-detection, research-code-quality]
    if: always()
    
    steps:
    - name: Generate Summary
      run: |
        echo "# Research Project Summary" >> $GITHUB_STEP_SUMMARY
        echo "Generated: $(date)" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## Workflow Results" >> $GITHUB_STEP_SUMMARY
        echo "- Claude Code Detection: ${{ needs.claude-code-detection.result }}" >> $GITHUB_STEP_SUMMARY
        echo "- Code Quality Check: ${{ needs.research-code-quality.result }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "*Generated by Claude Code Research Workflow*" >> $GITHUB_STEP_SUMMARY